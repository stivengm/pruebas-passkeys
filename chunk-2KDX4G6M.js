import{a as Y}from"./chunk-FEOETI4K.js";import{a as o}from"./chunk-6N2SWU4J.js";import{s as W}from"./chunk-OWWYICLM.js";import{b as U}from"./chunk-XSAAQTIS.js";import{a as H}from"./chunk-XHWH72AI.js";import{a as K}from"./chunk-NJ3E4L6N.js";import{a as V}from"./chunk-YF3TQPZC.js";import{a as $,b as Z,d as q}from"./chunk-PDRDT2QT.js";import{a as D,b as u,c as O,d as L,g as b,k as x}from"./chunk-Z7AQ5W2I.js";import{a as Q}from"./chunk-5S3YCTQA.js";import{a as j}from"./chunk-WUTQ432T.js";import{Ob as E,Pb as P,Rb as k,Ua as A,Ya as d,_a as c,a as w,b as T,cb as g,eb as m,fb as s,gb as a,hb as C,ib as F,ic as z,jb as R,k as l,ka as I,na as N,ob as f,wb as p,wc as B,yc as M}from"./chunk-PLWOJE2C.js";var v=class{constructor(i,e){this._el=i,this._control=e}onInput(i){let e=this._el.nativeElement.value.split(" ").join("");if(!/^\d+$/.test(i.data)&&i.data!==null){this._control.valueAccessor?.writeValue(e.slice(0,-1));return}}},y=v;(()=>{v.\u0275fac=function(e){return new(e||v)(c(A),c(O))}})(),(()=>{v.\u0275dir=N({type:v,selectors:[["","onlyNumber",""]],hostBindings:function(e,t){e&1&&f("input",function(r){return t.onInput(r)})}})})();var ne=["inputEmail"],oe=["inputPhone"];function ae(h,i){h&1&&(s(0,"p",16),p(1," El correo electr\xF3nico no es correcto "),a())}function se(h,i){h&1&&(s(0,"p",16),p(1," El n\xFAmero de tel\xE9fono no es correcto "),a())}function re(h,i){h&1&&(F(0),p(1," Siguiente "),R())}function le(h,i){h&1&&(s(0,"div",17),C(1,"span",18),a())}var _=class{constructor(i,e,t,n,r){this._activatedRoute=i,this._snackBar=e,this._modalService=t,this._changeDectetorRef=n,this._envStore=r,this.loading=!1,this._acceptTyCExternal=!1,this._otp=!0,this.emailControl=new b("",[u.required,u.minLength(5),u.maxLength(150),u.pattern("^[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[A-Za-z0-9](?:[A-Za-z0-9-]*[A-Za-z0-9])?\\.)+[A-Za-z0-9](?:[A-Za-z0-9-]*[A-Za-z0-9])?$")]),this.phoneNumberControl=new b("",[u.required,u.minLength(10),u.maxLength(15)]),this._parameters=new q}ngOnInit(){let i=this._envStore.env;i.ENTITY_ID=i.PRODUCTION?"7":"4";let e=!1,t=!1;this._paramsSub=this._activatedRoute.queryParams.subscribe(n=>{n.hasOwnProperty("terms")&&(this._acceptTyCExternal=!0),n.hasOwnProperty("loader")&&(e=!0),n.hasOwnProperty("hidden")&&(t=!0),n.hasOwnProperty("otp")&&(this._otp=!1),this._enrollment=new Y(i,void 0,e,t)})}keyEnter(i){if(i.key==="Enter"){if(this.emailControl.invalid){this.inputEmail.nativeElement.focus();return}if(this.phoneNumberControl.invalid){this.inputPhone.nativeElement.focus();return}this.preOnSubmit()}}ngOnDestroy(){this._paramsSub.unsubscribe()}preOnSubmit(){this.emailControl.valid&&this.phoneNumberControl.valid?this._onSubmit():(this.emailControl.markAllAsTouched(),this.phoneNumberControl.markAllAsTouched())}onBack(){return l(this,null,function*(){yield this._resetForm(),yield this._closeModal();let{WelcomeSoyyoComponent:i}=yield import("./welcome-soyyo.component-HEMPA5X6.js");this._modalService.openModal(i,{identification:this.identification})})}_activatedUser(i){return l(this,null,function*(){try{yield this.getToken();let e=yield this.activation(Number(i)),{ResponseModalComponent:t}=yield import("./response-modal.component-KRHMBIWX.js");if(e.code=="EP001")return this._modalService.openModal(t,{typeResponse:e.data?.identityLevel===2?"success":e.data?.identityLevel===1?"warning":"error",title:e.data?.identityLevel===2?"\xA1Felicitaciones!":e.data?.identityLevel===1?"No hemos logrado validar tu identidad a\xFAn":"Algo sali\xF3 mal",message:e.data?.identityLevel===2?"Ahora tienes tu identidad digital en SoyYo":e.data?.identityLevel===1?"Por favor cont\xE1ctanos para que podamos ayudarte":"No pudimos crear tu identidad, vuelve a intentarlo"}),e;this._modalService.openModal(t,{typeResponse:"error",title:"Algo sali\xF3 mal",message:"No pudimos crear tu identidad, vuelve a intentarlo"})}catch{this._snackBar.openFromComponent(o,{duration:3e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["red-snack"],data:{message:"Error en llamado a servicios internos"}})}})}getToken(){return l(this,null,function*(){let i=$.getEnviroments(),e=new URLSearchParams;e.append("grant_type","client_credentials");let t={method:"POST",mode:"cors",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${btoa(i.clientId+":"+i.clientSecret)}`},body:e};return(yield(yield fetch(`${i.endPoints.API_COGNITO}/oauth2/token`,t)).json()).access_token})}activation(i){return l(this,null,function*(){let e=yield this.getToken(),t=this._constructorData(),n=yield this._parameters.getParameters("UrlsSDKWeb"),r=Z(n,"userActivation"),G=this._envStore.env,J=yield fetch(`${r}${t.channel}/${i}`,{method:"PUT",mode:"cors",headers:{Authorization:`Bearer ${e}`,"x-Api-Key":G.API_KEY,"Content-Type":"application/json"}});try{return yield J.json()}catch(S){return S}})}_closeModal(){this._modalService.closeModal(),this._changeDectetorRef.detectChanges()}_onSubmit(){return l(this,null,function*(){this.loading=!0,this._changeDectetorRef.detectChanges();let i=this._constructorData();yield this._enrollment.basicDataRegister(T(w({},i),{acceptTyCExternal:this._acceptTyCExternal}),e=>{let t=e.data.processId;i.processId=t,this._captureFace(i)},e=>l(this,null,function*(){if(this._modalService.closeModal(),this.loading=!1,e.code=="EP002"&&e.data?.errors?.length>0){let{WelcomeSoyyoComponent:t}=yield import("./welcome-soyyo.component-HEMPA5X6.js");this._modalService.openModal(t,{identification:this.identification}),this._snackBar.openFromComponent(o,{duration:3e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["red-snack"],data:{message:"Verifica los datos ingresados"}})}else if(e.code=="EP002"){yield this._closeModal();let{WelcomeSoyyoComponent:t}=yield import("./welcome-soyyo.component-HEMPA5X6.js");this._modalService.openModal(t),this._openModalUSerExistFunc()}else e.code=="EP003"?this._snackBar.openFromComponent(o,{duration:3e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["red-snack"],data:{message:e.message}}):e.code=="EP008"?this._snackBar.openFromComponent(o,{duration:3e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["red-snack"],data:{message:e.message}}):e.code=="EXN007"?this._snackBar.openFromComponent(o,{duration:3e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["red-snack"],data:{message:e.message}}):e.code=="EXN008"?this._snackBar.openFromComponent(o,{duration:3e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["red-snack"],data:{message:e.message}}):e.message=="Registro cancelado"?this._snackBar.openFromComponent(o,{duration:3e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["info-snack"],data:{message:e.message}}):e.code==="T005"?this._snackBar.openFromComponent(o,{duration:3e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["red-snack"],data:{message:e.message}}):e.code==="EP015"?this._snackBar.openFromComponent(o,{duration:3e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["red-snack"],data:{message:e.message}}):(this.loading=!1,this._snackBar.openFromComponent(o,{duration:3e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["red-snack"],data:{message:"Error el servidor no pudo procesar los datos b\xE1sicos"}}))}),void 0,({code:e})=>{e==="ACT_LOADED"&&(this._closeModal(),this.loading=!1,this._resetForm())})})}_captureFace(i){this._enrollment.captureFace(i,e=>{switch(e.liveness.code){case"EP006":this._enrollment.documentValidate(i,()=>{this._activatedUser(e.liveness.data.processId)},t=>{t.code==="T005"?this._snackBar.openFromComponent(o,{duration:3e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["red-snack"],data:{message:"Error en servicios externos"}}):t.code==="EP007"?this._snackBar.openFromComponent(o,{duration:3e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["red-snack"],data:{message:"Supero n\xFAmero m\xE1ximo de intentos"}}):this._snackBar.openFromComponent(o,{duration:3e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["red-snack"],data:{message:t.message}})});break;case"EP004":this._activatedUser(e.liveness.data.processId);break;default:this.loading=!1,this._snackBar.openFromComponent(o,{duration:3e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["red-snack"],data:{message:"El usuario ya se encuentra registrado"}})}},e=>{e.code==="EP007"?this._snackBar.openFromComponent(o,{duration:3e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["red-snack"],data:{message:e.message}}):e.code==="EP005"?l(this,null,function*(){let{ResponseModalComponent:t}=yield import("./response-modal.component-KRHMBIWX.js");this._modalService.openModal(t,{typeResponse:"error",title:"\xA1Error!",message:e.data.description})}):e.code!=null&&this._snackBar.openFromComponent(o,{duration:3e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["red-snack"],data:{message:"La validaci\xF3n no fue exitosa"}})})}_resetForm(){this.emailControl.reset(""),this.phoneNumberControl.reset("")}_constructorData(){return this.inputEmail.nativeElement.blur(),this.inputPhone.nativeElement.blur(),{entityId:this._envStore.env.PRODUCTION?"7":"4",processType:"ENR",documentType:this.documentType,identificationNumber:this.identification,phoneIndicative:"57",phoneNumber:this.phoneNumberControl.value,channel:"WEB_CLIENT",email:this.emailControl.value,appIdentifier:"web.demo.idcolombia",otpInternal:this._otp,internalTutor:!0}}_openModalUSerExistFunc(){return l(this,null,function*(){let{UserExistComponent:i}=yield import("./user-exist.component-3RJSL46P.js");this._modalService.openModal(i)})}},X=_;(()=>{_.\u0275fac=function(e){return new(e||_)(c(U),c(W),c(j),c(z),c(Q))}})(),(()=>{_.\u0275cmp=I({type:_,selectors:[["app-registry"]],viewQuery:function(e,t){if(e&1&&(P(ne,5),P(oe,5)),e&2){let n;E(n=k())&&(t.inputEmail=n.first),E(n=k())&&(t.inputPhone=n.first)}},inputs:{identification:"identification",documentType:"documentType"},decls:26,vars:8,consts:[["title",""],["right",""],[1,"heading"],[1,"form"],[1,"text-fields"],["for","correo"],[1,"field"],["inputmode","email","type","email","autocomplete","nope","autocorrect","off","autocapitalize","none","spellcheck","false",1,"min-heigth",3,"formControl","keydown"],["inputEmail",""],["class","helper",4,"ngIf"],[1,"info"],["onlyNumber","","inputmode","numeric","autocomplete","nope","autocorrect","off","autocapitalize","none","spellcheck","false",1,"min-heigth",3,"formControl","keydown"],["inputPhone",""],["actions","","type","button",1,"button","large-btn",3,"ngClass","disabled","click"],[4,"ngIf"],["class","spinner-border text-light","role","status",4,"ngIf"],[1,"helper"],["role","status",1,"spinner-border","text-light"],[1,"visually-hidden"]],template:function(e,t){e&1&&(s(0,"app-sy-modal"),C(1,"app-sy-logo",0)(2,"app-sy-close-modal",1),s(3,"div",2)(4,"h4"),p(5,"Registro de datos personales"),a()(),s(6,"div",3)(7,"div",4)(8,"label",5),p(9,"Tu correo electr\xF3nico"),a(),s(10,"div",6)(11,"input",7,8),f("keydown",function(r){return t.keyEnter(r)}),a()(),g(13,ae,2,0,"p",9),a(),s(14,"div",4)(15,"sub"),p(16,"Tu celular"),a(),s(17,"div",6)(18,"div",10),p(19,"+57"),a(),s(20,"input",11,12),f("keydown",function(r){return t.keyEnter(r)}),a()(),g(22,se,2,0,"p",9),a()(),s(23,"button",13),f("click",function(){return t.preOnSubmit()}),g(24,re,2,0,"ng-container",14),g(25,le,2,0,"div",15),a()()),e&2&&(d(11),m("formControl",t.emailControl),d(2),m("ngIf",t.emailControl.invalid&&(t.emailControl.dirty||t.emailControl.touched)),d(7),m("formControl",t.phoneNumberControl),d(2),m("ngIf",t.phoneNumberControl.invalid&&(t.phoneNumberControl.dirty||t.phoneNumberControl.touched)),d(1),m("ngClass",t.emailControl.valid&&t.phoneNumberControl.valid?"active-btn":"disable-btn")("disabled",t.emailControl.invalid||t.phoneNumberControl.invalid||t.loading),d(1),m("ngIf",!t.loading),d(1),m("ngIf",t.loading))},dependencies:[B,M,D,L,x,y,H,V,K],styles:["sub[_ngcontent-%COMP%]{font-size:1rem;display:block;position:static;margin-bottom:24px;color:var(--body-font-color);font-weight:500}"]})})();export{X as a};
